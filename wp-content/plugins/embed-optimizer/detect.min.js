const consoleLogPrefix="[Embed Optimizer]";function log(...e){console.log(consoleLogPrefix,...e)}function error(...e){console.error(consoleLogPrefix,...e)}const loadedElementContentRects=new Map;export async function initialize({isDebug:e}){const t=document.querySelectorAll(".wp-block-embed > .wp-block-embed__wrapper[data-od-xpath]");for(const o of t)monitorEmbedWrapperForResizes(o,e);e&&log("Loaded embed content rects:",loadedElementContentRects)}export async function finalize({isDebug:e,getElementData:t,extendElementData:o}){for(const[n,r]of loadedElementContentRects.entries())try{o(n,{resizedBoundingClientRect:r}),e&&log(`boundingClientRect for ${n} resized:`,t(n).boundingClientRect,"=>",r)}catch(e){error(`Failed to extend element data for ${n} with resizedBoundingClientRect:`,r,e)}}function monitorEmbedWrapperForResizes(e,t){if(!("odXpath"in e.dataset))throw new Error("Embed wrapper missing data-od-xpath attribute.");const o=e.dataset.odXpath;new ResizeObserver((e=>{const[n]=e;loadedElementContentRects.set(o,n.contentRect),t&&log(`Resized element ${o}:`,n.contentRect)})).observe(e,{box:"content-box"})}